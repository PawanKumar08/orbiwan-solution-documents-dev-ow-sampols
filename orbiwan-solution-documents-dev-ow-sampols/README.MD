From the top directory get the latest version of the OW-DOC-STACK:

> git CLONE git@10.8.74.150:pkthomsen/ow-doc-stack.git

> cd ow-doc-stack
> npm install
> cd ..

The please check the ow-doc-stack mkdoc script to see how to install the needed tools.

Finally you can enter and build one of the system documents, e.g.

> cd solution-security-architecture
> ./mkdoc


# Development and Deployment of OrbiWiki

### Deployment
Since there are two different websites, there are two directories where the code is deployed, depending on the requirement where you are deploying.
1. Deploying dev.resources
> Open the file - deploy_site_ejs.sh and in line number 4, set the PROJECT_DIR as /var/www/html

Now you can deploy, Run -

```
./deploy_site_ejs.sh
```

2. Deploying ow-standard
> Open the file - deploy_site_ejs.sh and in line number 4, set the PROJECT_DIR as /var/www/html-ow-standard

Now you can deploy, Run -

```
./deploy_site_ejs.sh
```
### Development

* Checkout the repository
  * > git CLONE git@10.8.74.150:pkthomsen/ow-doc-stack.git
* Put the content in orbiwiki directory


Learnings

- for images, use {{page.image_path}}
- Do not use width like width=50%, the values must be proper in quotes



# Jekyll Doc Build system.

The purpose of this repository is to maintain the build system for documentation. The tools in this repository will fetch the documentation files from respective repository and build presentable content.

The documentation can be - 
- Getting started with OrbiWAN
- User Manuals
- API documentation
- Sensor related documentation
- Various applications e.g Noise App etc.

## Directory structure of a website

A directory structure of the jekyll website would be -
```
.
├── _config.yml
├── _data
│   └── members.yml
├── _drafts
│   ├── begin-with-the-crazy-ideas.md
│   └── on-simplicity-in-technology.md
├── _includes
│   ├── footer.html
│   └── header.html
├── _layouts
│   ├── default.html
│   └── post.html
├── _posts
│   ├── 2007-10-29-why-every-programmer-should-play-nethack.md
│   └── 2009-04-26-barcamp-boston-4-roundup.md
├── _sass
│   ├── _base.scss
│   └── _layout.scss
├── _site --> this is the actual site htmls generated by jekyll
├── .jekyll-metadata
└── index.html # can also be an 'index.md'
```

## Building and Running the server - Docker

### Creating a new site in current directory

```
export JEKYLL_VERSION=3.5

docker run --rm --volume="$PWD:/srv/jekyll" -it jekyll/jekyll:$JEKYLL_VERSION jekyll new .
```

### Creating a new site in a new directory named my_site

```
export JEKYLL_VERSION=3.5

docker run --rm --volume="$PWD:/srv/jekyll" -it jekyll/jekyll:$JEKYLL_VERSION jekyll new my_site
```


### Building the website
```
docker run --rm --volume="$PWD:/srv/jekyll" -it jekyll/jekyll:$JEKYLL_VERSION jekyll build
```
This will build the html files using .md files and place in _site directory.

### Running the jekyll server
```
docker run --name my_site --volume="$PWD:/srv/jekyll" -p 3000:4000 -it jekyll/jekyll:$JEKYLL_VERSION jekyll serve --watch
```
This will run jekyll server.

### Restarting the jekyll server
```
docker restart my_site
```


## Building and Running the server - Locally

### Install the dependencies
```
bundle install
```
This will install all required gems from the Gemfile

### Building the website
```
bundle exec jekyll build
```
This will build the html files using .md files and place in _site directory.

### Running the jekyll server
```
bundle exec jekyll serve
```
This will run jekyll server.

## For Developers using docker

### Continuous build
```
export JEKYLL_VERSION=3.5
cd resources_docs
docker run --rm --volume="$PWD:/srv/jekyll" -it jekyll/jekyll:$JEKYLL_VERSION jekyll build --watch
```


### Run with live reload
```
export JEKYLL_VERSION=3.5
cd resources_docs
docker run --name resources_docs --volume="$PWD:/srv/jekyll" -p 3000:4000 -it jekyll/jekyll:$JEKYLL_VERSION jekyll serve --watch
```


# Making of .md files

Things to remember -

1. Add front matter at the top of every .md file

```
---
layout: "page|section"
type: "section"
ow_parent: "DASS"
ow_tile: "Batch Registration"
ow_last_updated: ""
tags: "tag1 tag2 tag3"
decsription: "content description"
---
```

2. Remove all html tags
3. Modify image paths
4. Keep the file names in camel case
5. Keep the content organised in folders


### SSHFS
```
sshfs ubuntu@resources.orbiwise.com:resources_docs remote_owdocs_dev
```


## Install jekyll on your machine

Site : https://jekyllrb.com/

For MacOS : https://jekyllrb.com/docs/installation/macos/

### Check for xcode, if it is not installed, do install.
```
xcode-select --install
```

### Check if ruby is there, if not, install it. Minimum ruby version required is 2.4.0
```
ruby -v
```

### Install ruby if it is not there
```
brew install ruby
```
### If it is already there and needs upgrade, do - 
```
brew upgrade ruby
```
### Install required gems
```
gem install --user-install bundler jekyll
```

> While bundle install, if you're asked for a root password, don't use root. Instead read the message printed. Install the gems locally rather than on root.

```
bundle install --path vendor/bundle
```

In this case, your gems will be installed in `vendor/bundle` path. You can change it to path of your choice. 

## Installation for Mac with Apple M1 Chip

You might see errors like 
> LoadError: dlopen(.gems/ruby/2.6.0/gems/ffi-1.14.2/lib/ffi_c.bundle, 0x0009): missing compatible arch in .gems/ruby/2.6.0/gems/ffi-1.14.2/lib/ffi_c.bundle - .gems/ruby/2.6.0/gems/ffi-1.14.2/lib/ffi_c.bundle

Install using - 
```
arch -arch x86_64 bundle install
arch -arch x86_64 bundle exec jekyll serve
```


docker run -t --rm \
    -e MEILISEARCH_HOST_URL=http://127.0.0.1:7700 \
    -e MEILISEARCH_API_KEY=this-is-my-secret-key-for-meilisearch \
    -v ABSOLUTE-PATH-TO-YOUR/config.json:/docs-scraper/config.json \
    getmeili/docs-scraper:latest pipenv run ./docs_scraper config.json